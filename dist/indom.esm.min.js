/*! InDom v1.0.0 MIT */
export class InDomArray extends Array{constructor(...e){super(...e)}setAttr(e,t){return this.#e("setAttr",[e,t])}removeAttr(e){return this.#e("removeAttr",[e])}setData(e,t){return this.#t(),this.#e("setData",[e,t])}removeData(e){return this.#t(),this.#e("removeData",[e])}setValue(e,t){return this.#e("setValue",[e,t])}setHtml(e){return this.#e("setHtml",[e])}setStyle(e,t){return this.#e("setStyle",[e,t])}addClass(...e){return this.#e("addClass",e)}removeClass(...e){return this.#e("removeClass",e)}append(...e){return this.#e("append",e)}prepend(...e){return this.#e("prepend",e)}after(...e){return this.#e("after",e)}before(...e){return this.#e("before",e)}on(e,t,n){this.#t();const r=new Array(this.length);for(let s=0;s<this.length;s++)r[s]=this[s].on(e,t,n);return r}once(e,t,n){return this.on(e,t,{...n,once:!0})}off(e,t){if(t){if(!Array.isArray(t)||t.length!==this.length)throw new RangeError(`Expected ${this.length} handlers, got ${t.length}`);this.forEach((n,r)=>n.off(e,t[r]))}else this.forEach(t=>t.off(e));return this}onClick(e,t){return this.on("click",e,t)}onDoubleClick(e,t){return this.on("dblclick",e,t)}onEnter(e,t){return this.on("mouseenter",e,t)}onLeave(e,t){return this.on("mouseleave",e,t)}onFocus(e,t){return this.on("focus",e,t)}onBlur(e,t){return this.on("blur",e,t)}onChange(e,t){return this.on("change",e,t)}onRemove(e){this.#t();const t=[];return this.forEach(n=>t.push(n.on("onRemove",e))),t}remove(){this.#e("remove",[])}each(e){return this.forEach(e),this}filter(e){return new InDomArray(..."string"==typeof e?super.filter(t=>t.el().matches(e)):super.filter(e))}#e(e,t){for(let n=0;n<this.length;n++)this[n][e](...t);return this}#t(){if(!InDom.isReady())throw new Error("DOM content must be loaded first for this operation");for(let e=0;e<this.length;e++)if(!this[e].el().isConnected)throw new Error("Element must be connected to DOM for this operation",{cause:this[e].el()})}}export class InDom{static#n=!1;static#r=[];static#s=new WeakMap;#o;#i;#h;#a;constructor(e){if(InDom.#s.has(e))return InDom.#s.get(e);if(e instanceof Document)return this.#i=e,void InDom.#s.set(e,this);const t=InDom.#l(e);if(!(t instanceof Element))throw new TypeError("Expected a DOM Element , Document or HTML string of a DOM Element",{cause:t});this.#i=t}static init(){if(this.#n)return;if(!document.body)return void document.addEventListener("DOMContentLoaded",()=>this.init(),{once:!0});const e=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,null);new MutationObserver(t=>{const n=new Set;for(const r of t)for(const t of r.removedNodes){if(1!==t.nodeType)continue;let r;for(this.#s.has(t)&&n.add(this.#s.get(t)),e.currentNode=t;(r=e.nextNode())&&t.contains(r);)this.#s.has(r)&&n.add(this.#s.get(r))}n.size>0&&queueMicrotask(()=>{for(const e of n)e.el().isConnected||e.remove()})}).observe(document.body,{childList:!0,subtree:!0}),this.#n=!0,this.#r.length>0&&(this.#r.forEach(e=>e()),this.#r.length=0)}static isReady(){return InDom.#n}static onReady(e){if("function"!=typeof e)throw new TypeError("onReady handler must be a function",{cause:e});this.#n?e():this.#r.push(e)}static get(e,t){if(t){t instanceof InDom&&(t=t.el());const n=(e=e.trim())[0];">"!=n&&"~"!=n&&"+"!=n||(e=":scope "+e)}else t=document;const n=t.querySelectorAll(e),r=n.length,s=new InDomArray(r);for(let e=0;e<r;e++)s[e]=InDom.#c(n[e]);return s}static getOne(e,t){if(t){t instanceof InDom&&(t=t.el());const n=(e=e.trim())[0];">"!=n&&"~"!=n&&"+"!=n||(e=":scope "+e)}else t=document;return InDom.#c(t.querySelector(e))}static getById(e){const t=document.getElementById(e);return t?InDom.#c(t):null}static getValues(...e){let t=e.length;const n=new Set;let r,s=!1,o=document;if(0==t)r=["[name]"],s=!0;else if(e[t-1]instanceof InDom&&(o=e.pop(),t--),0==t)r=["[name]"],s=!0;else if(Array.isArray(e[0])&&(t=(e=e[0]).length),0==t)r=["[name]"];else{r=new Array(t);for(let s=0;s<t;s++){const t=e[s];if("string"!=typeof t||!t)throw new TypeError("Field names, if given, must be a non-empty strings",{cause:t});t.endsWith("_")?(n.add(t.slice(0,-1)),r[s]=`[name^="${t}"]`):r[s]=`[name="${t}"]`}}const i={};return InDom.get(r.join(", "),o).each(e=>{const t=e.el().tagName.toLowerCase();if("input"==t||"textarea"==t||"select"==t){const t=e.getAttr("name"),r=e.getValue(o),h=t.indexOf("_");if(-1==h)return void(i[t]=r);const a=t.slice(0,h);if(s||n.has(a))return InDom.#u(i[a])||(i[a]={}),void(i[a][t.slice(h+1)]=r);i[t]=r}}),i}static#u(e){return e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}static#c(e){if(!e)return null;if(this.#s.has(e))return this.#s.get(e);const t=new InDom(e);return this.#s.set(e,t),t}static#m(e){return 1===e.length&&Array.isArray(e[0])?e[0]:e}static#l(e){if(e instanceof InDom)return e.el();if(e instanceof Node)return e;const t=String(e).trim();if(!t)return document.createTextNode("");const n=document.createRange().createContextualFragment(t);return 1===n.childNodes.length&&n.firstChild.nodeType===Node.ELEMENT_NODE||1===n.childNodes.length&&n.firstChild.nodeType===Node.TEXT_NODE?n.firstChild:n}prepend(...e){return this.#d(),e=InDom.#m(e),[...e].reverse().forEach(e=>{this.#i.prepend(InDom.#l(e))}),this}append(...e){this.#d(),e=InDom.#m(e);for(const t of e)this.#i.appendChild(InDom.#l(t));return this}before(...e){return this.#d(),e=InDom.#m(e),[...e].forEach(e=>{this.#i.before(InDom.#l(e))}),this}after(...e){this.#d(),e=InDom.#m(e);for(const t of e.reverse())this.#i.after(InDom.#l(t));return this}on(e,t,n={}){this.#t();const r=Array.isArray(e)?e:[e];for(let t=0;t<r.length;t++)if("string"!=typeof r[t]||!r[t])throw new TypeError("Event type must be a non-empty string",{cause:e});if(void 0===t){for(let e=0;e<r.length;e++)if(!r[e].includes("mouse")&&!r[e].includes("click"))throw new Error(`Auto-trigger only supported for mouse events, not '${r[e]}'`);for(let e=0;e<r.length;e++)this.#i.dispatchEvent(new MouseEvent(r[e],{bubbles:!0,cancelable:!0,view:window}));return()=>{}}if("function"!=typeof t)throw new TypeError("Event handler must be a function",{cause:t});if(!InDom.#u(n))throw new TypeError("Options must be an object if defined",{cause:n});this.#f(),n={...n,signal:this.#h.signal};const s=t.bind(null,this);for(let e=0;e<r.length;e++)this.#p(r[e]),this.#i.addEventListener(r[e],s,n),this.#o[r[e]].add(s);return s}off(e,t){if(this.#d(),!this.#o)return this;if("onRemove"==e)return this.#v(t);if(void 0===e){this.#v();for(const e in this.#o){for(const t of this.#o[e])this.#i.removeEventListener(e,t);delete this.#o[e]}return this}if("string"!=typeof e||!e)throw new TypeError("Event type, if given, must be a non-empty string",{cause:e});if(!this.#o[e])return this;if(void 0===t){for(const t of this.#o[e])this.#i.removeEventListener(e,t);return delete this.#o[e],this}return this.#i.removeEventListener(e,t),this.#o[e].delete(t),0===this.#o[e].size&&delete this.#o[e],this}once(e,t,n={}){return this.on(e,t,{...n,once:!0})}onClick(e,t){return this.on("click",e,t)}onDoubleClick(e,t){return this.on("dblclick",e,t)}onEnter(e,t){return this.on("mouseenter",e,t)}onLeave(e,t){return this.on("mouseleave",e,t)}onFocus(e,t){return this.on("focus",e,t)}onBlur(e,t){return this.on("blur",e,t)}onChange(e,t){return this.on("change",e,t)}onRemove(e){if(this.#t(),"function"!=typeof e)throw new TypeError("Remove event handler must be a function",{cause:e});this.#p("onRemove");const t=e.bind(null,this);return this.#o.onRemove.add(t),t}el(){return this.#d(),this.#i}getElement(){return this.el()}addClass(...e){return this.#d(),this.#i.classList.add(...e),this}hasClass(e){return this.#d(),this.#i.classList.contains(e)}removeClass(...e){return this.#d(),this.#i.classList.remove(...e),this}hasAttr(e){return this.#d(),this.#i.hasAttribute(e)}getAttr(e){return this.#d(),this.#i.getAttribute(e)}setAttr(e,t){return this.#d(),this.#i.setAttribute(e,t),this}removeAttr(e){return this.#d(),this.#i.removeAttribute(e),this}hasData(e){return this.hasAttr("data-"+e)||this.#a&&this.#a.has(e)}getData(e){this.#t();const t="data-"+e;return this.hasAttr(t)?this.getAttr(t):(this.#g(),this.#a.get(e))}setData(e,t){this.#t();const n="data-"+e;return this.hasAttr(n)?this.setAttr(n,t):(this.#g(),this.#a.set(e,t)),this}removeData(e){this.#t();const t="data-"+e;return this.hasAttr(t)?this.removeAttr(t):(this.#g(),this.#a.delete(e)),this}setHtml(e){return this.#d(),this.#i.innerHTML=e,this}getHtml(){return this.#d(),this.#i.innerHTML}setStyle(e,t){if(this.#d(),2===arguments.length&&(e={[e]:t}),!InDom.#u(e))throw new TypeError("css param must be an object");for(const t in e){const n=t.includes("-")?t.replace(/-([a-z])/g,(e,t)=>t.toUpperCase()):t;this.#i.style[n]=e[t]}return this}getStyle(...e){this.#d();const t=window.getComputedStyle(this.#i),n=e.length;if(0==n)return t;if(1==n)return t.getPropertyValue(e[0]);const r={};for(const n of e)r[n]=t.getPropertyValue(n);return r}is(e){return this.#d(),this.#i.matches(e)}getSelfOrParent(e){return this.#d(),InDom.#c(this.#i.closest(e))}getParent(e){this.#d();const t=this.#i.parentElement;return InDom.#c(e?t?.closest(e):t)}getPrev(e){return this.#d(),this.#E("previousElementSibling",e)}getNext(e){return this.#d(),this.#E("nextElementSibling",e)}getBox(){return this.#d(),this.#i.getBoundingClientRect()}getOuterBox(){this.#d();const e=this.getBox(),t=window.getComputedStyle(this.#i),n=parseFloat(t.marginTop)||0,r=parseFloat(t.marginLeft)||0;return new DOMRect(e.left-r,e.top-n,e.width+r+(parseFloat(t.marginRight)||0),e.height+n+(parseFloat(t.marginBottom)||0))}getRelativeBox(){this.#d();const e=this.getBox(),t=this.#i.offsetParent;let n=0,r=0;if(t&&t!==document.body&&t!==document.documentElement){const e=t.getBoundingClientRect(),s=window.getComputedStyle(t);n=e.left+(parseFloat(s.borderLeftWidth)||0),r=e.top+(parseFloat(s.borderTopWidth)||0)}return new DOMRect(e.left-n,e.top-r,e.width,e.height)}getValue(e){this.#d(),e?e instanceof InDom&&(e=e.el()):e=document;const t=this.#i;if("SELECT"===t.tagName&&t.multiple)return[...t.selectedOptions].map(e=>e.value);if("SELECT"===t.tagName)return t.value||null;if("checkbox"===t.type)return[...e.querySelectorAll(`input[type="checkbox"][name="${t.name}"]:checked`)].map(e=>e.value);if("radio"===t.type){const n=e.querySelector(`input[name="${t.name}"]:checked`);return n?n.value:null}return"file"===t.type?t.files:"value"in t?t.value:null}setValue(e,t){this.#d(),t?t instanceof InDom&&(t=t.el()):t=document;const n=this.#i,r=Array.isArray(e)?e:[e];if("SELECT"===n.tagName&&n.multiple)return[...n.options].forEach(e=>e.selected=r.includes(e.value)),this;if("checkbox"===n.type)return[...t.querySelectorAll(`input[type="checkbox"][name="${n.name}"]`)].forEach(e=>e.checked=r.includes(e.value)),this;if("radio"===n.type)return[...t.querySelectorAll(`input[type="radio"][name="${n.name}"]`)].forEach(e=>e.checked=r.includes(e.value)),this;if("value"in n)return n.value=String(r[0]??""),this;throw new TypeError("Element has no value to set",{cause:n})}remove(){this.#d(),this.#i.remove(),this.#y()}#d(){if(!this.#i)throw new Error("The element has been removed")}#f(){this.#h||(this.#h=new AbortController)}#g(){this.#a||(InDom.#s.has(this.#i)||InDom.#s.set(this.#i,this),this.#a=new Map)}#p(e){this.#o||(InDom.#s.has(this.#i)||InDom.#s.set(this.#i,this),this.#o={}),this.#o[e]||(this.#o[e]=new Set)}#t(){if(!InDom.#n)throw new Error("DOM content must be loaded first for this operation");if(this.#d(),!this.#i.isConnected)throw new Error("Element must be connected to DOM for this operation",{cause:this.#i})}#v(e){return this.#o.onRemove?void 0===e?(delete this.#o.onRemove,this):(this.#o.onRemove.delete(e),0===this.#o.onRemove.size&&delete this.#o.onRemove,this):this}#E(e,t){let n=this.#i[e];for(;n;){if(!t||n.matches(t))return InDom.#c(n);n=n[e]}return null}#y(){this.#d(),this.#h&&(this.#h.abort(),this.#h=null),this.#a&&(this.#a.clear(),this.#a=null);const e=this.#o&&this.#o.onRemove?this.#o.onRemove:[];this.#o=null,InDom.#s.delete(this.#i),e.forEach(e=>e(this)),this.#i=null}}export const $a=InDom.get;export const $1=InDom.getOne;export const $id=InDom.getById;export const $n=e=>new InDom(e);export const $v=InDom.getValues;InDom.init();
//# sourceMappingURL=indom.esm.min.js.map